
<div class="sg-reserve">
  {{!-- Header --}}
  <div class="sg-header">
    {{!-- Product infos --}}
    <div class="sg-header-product">
      <img src="{{product.imageUrl}}" />
      <div class="sg-product-info">
        <span>{{product.name}}</span>
        <span>{{t 'storeList.quantity'}}: {{product.quantity}}</span>
        <span>
          {{#each product.options}}
            {{name}}: {{value}}
            {{#unless @last}}
            ,&nbsp;
            {{/unless}}
          {{/each}}
        </span>
      </div>
    </div>
    <div class="sg-divider"></div>
  </div>

  {{!-- Store infos --}}
  <div class="sg-store">
    <div class="sg-store-name">
      {{location.name}}
      {{>link label="reserve.changeStore" href="#" class="sg-store-change"}}
    </div>

    <div class="sg-store-detail">
      <div>
        <p class="sg-bold">{{t "storeList.location.address" }}</p>
        <p>{{location.primaryAddress.street}} {{location.primaryAddress.street2}}</p>
        <p>{{location.primaryAddress.city}}, {{location.primaryAddress.region}} {{location.primaryAddress.postalCode}}</p>
        {{> link
            class="sg-directions"
            label="storeList.location.directions"
            href=(direction location.primaryAddress)
            target="_blank"
        }}
      </div>
      <div>
        {{#if location.operationHours}}
          <p class="sg-bold">{{t "storeList.location.storeHours" }}</p>
          {{#each location.operationHours}}
            {{#if this}}
              <p>{{t (concat "date." @key) }}: {{this}}</p>
            {{/if}}
          {{/each}}
        {{/if}}
      </div>
    </div>

    {{!-- Form --}}
    <div class="sg-form">
      <div class="sg-section">
        <span>{{t "reserve.contactInfo" }}</span>
        <div class="sg-form-row">
          {{> textField id="sg-reserve-first-name" label="reserve.firstName" }}
          {{> textField id="sg-reserve-last-name" label="reserve.lastName" }}
        </div>
        <div class="sg-form-row">
          {{> textField id="sg-reserve-phone-number" label="reserve.phoneNumber" }}
          {{> textField id="sg-reserve-email" label="reserve.email" }}
        </div>
      </div>
      <div class="sg-section">
        <span>{{t "reserve.pickupQuestion" }}</span>
        <fieldset id="sg-reserve-pickup">
          <div class="sg-form-radio-row">
            {{>radio id="sg-reserve-pickup-me" name="sg-reserve-pickup" value="me" label="reserve.me" checked=true}}
          </div>
          <div class="sg-form-radio-row">
            {{>radio name="sg-reserve-pickup" value="someoneElse" label="reserve.someoneElse"}}
          </div>
        </fieldset>
      </div>
      <div class="sg-section sg-pickup-contact sg-hidden">
        <span>{{t "reserve.pickupInfo" }}</span>
        <div class="sg-form-row">
          {{> textField id="sg-reserve-pickup-first-name" label="reserve.firstName" }}
          {{> textField id="sg-reserve-pickup-last-name" label="reserve.lastName" }}
        </div>
        <div class="sg-form-row">
          {{> textField id="sg-reserve-pickup-phone-number" label="reserve.phoneNumber" }}
          {{> textField id="sg-reserve-pickup-email" label="reserve.email" }}
        </div>
      </div>
      <div class="sg-section sg-legal">
        {{#if legal.terms }}
          {{#> checkbox id="sg-reserve-terms" }}
            {{t "reserve.terms.text" }}
            {{> link href=legal.terms label="reserve.terms.link" target="_blank" }}
          {{/checkbox}}
        {{/if}}
        {{#if legal.privacy }}
          {{#> checkbox id="sg-reserve-privacy" }}
            {{t "reserve.privacy.text" }}
            {{> link href=legal.privacy label="reserve.privacy.link" target="_blank" }}
          {{/checkbox}}
        {{/if}}
        {{> button id="sg-reserve-submit" label="reserve.submit" disabled=(or legal.terms legal.privacy) }}
      </div>
    </div>
  </div>
</div>

<script>
  SgOmniEnablement.onLoad(function (controller) {
    {{!-- Prefill data --}}
    controller.prefillFormData();
    {{!-- Handle store change --}}
    document.querySelector('#sg-omni .sg-store-change').addEventListener('click', function (e) {
      e.preventDefault();
      controller.app.popRoute();
    });
    {{!-- Handle reserve submit --}}
    var reserveButton = document.querySelector('#sg-reserve-submit');
    reserveButton.addEventListener('click', function (e) {
      e.preventDefault();
      controller.submit();
    });
    {{!-- Handle terms/privacy checkbox --}}
    var legals = Array.prototype.slice.call(document.querySelectorAll('#sg-omni .sg-legal input[type="checkbox"]'));
    legals.forEach(function (checkbox) {
      checkbox.addEventListener('change', function () {
        var allChecked = legals.every(function(check) { return check.checked === true });
        reserveButton.disabled = !allChecked;
      });
    });
    {{!-- Handle pickup person switcher --}}
    var reservePickup = document.querySelector('#sg-reserve-pickup');
    var reservePickupSection = document.querySelector('#sg-omni .sg-pickup-contact');
    reservePickup.addEventListener('change', function (e) {
      if (e.target.value === 'me') {
        reservePickupSection.classList.add('sg-hidden');
      } else {
        reservePickupSection.classList.remove('sg-hidden');
        reservePickupSection.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>